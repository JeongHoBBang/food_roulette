<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.food_roulette.tag_menu.TagMenuMapper">
        <select id="findMenuTag">
                SELECT C.itag,C.tag
                FROM p_tag_menu A
                INNER JOIN (
                        SELECT icommon_menu,menu
                        FROM p_common_menu
                        UNION
                        SELECT iuser_menu,menu
                        FROM p_user_menu A
                )B
                ON A.imenu=B.icommon_menu
                INNER JOIN p_tag C
                ON A.itag=C.itag
                WHERE B.menu=#{menu}
        </select>

        <select id="getTagMenu">
                SELECT  A.itag,A.imenu,B.menu  ,COUNT(*)
                from p_tag_menu A
                INNER JOIN (
                        SELECT icommon_menu ,menu
                        FROM p_common_menu
                        UNION
                        SELECT iuser_menu ,menu
                        FROM p_user_menu
                ) B
                ON A.imenu=B.icommon_menu
                WHERE A.itag
                        IN
                <foreach collection="list" item="item" open="(" separator="," close=")">
                        #{item.itag}
                </foreach>
                GROUP BY A.imenu
                HAVING COUNT(*)>=#{size}
        </select>
</mapper>